<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Śruti: The Gita Listening Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lora:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    
    <!-- PWA Manifest Link -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#F4F1E9">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F4F1E9; }
        .prose-styles { font-family: 'Lora', serif; color: #4B4237; font-size: 1.125rem; line-height: 1.7; }
        .prose-styles p, .prose-styles ul { margin-bottom: 1.25em; }
        .prose-styles h3 { font-family: 'Inter', sans-serif; font-weight: 600; font-size: 1.5rem; margin-bottom: 1rem; color: #4A553A; }
        .playlist-item { transition: background-color 0.3s, color 0.3s; }
        .playlist-item.active { background-color: #4A553A; color: #FFFFFF; }
        audio::-webkit-media-controls-panel { background-color: #E8E2D9; }
        .gemini-button:disabled { background-color: #b5bba9; cursor: not-allowed; }
        .spinner { border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: #fff; width: 16px; height: 16px; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.7s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .menu-open { transform: translateX(0%); }
        .menu-closed { transform: translateX(-100%); }
    </style>
</head>
<body class="text-stone-800 antialiased">

    <div class="relative min-h-screen md:flex">
        <!-- Mobile Header -->
        <div class="md:hidden flex justify-between items-center p-4 bg-white border-b border-stone-200 sticky top-0 z-30">
            <h1 class="text-xl font-bold text-[#4A553A]">Śruti</h1>
            <button id="mobile-menu-button" class="p-2">
                <svg class="w-6 h-6 text-stone-700" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor"><path d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>

        <!-- Left Panel: Playlist -->
        <aside id="playlist-panel" class="fixed inset-y-0 left-0 z-40 w-4/5 max-w-sm bg-white border-r border-stone-200 flex flex-col transition-transform duration-300 ease-in-out menu-closed md:relative md:w-1/3 lg:w-1/4 xl:w-1/5 md:translate-x-0">
            <div class="p-6 border-b border-stone-200 hidden md:block">
                <h1 class="text-3xl font-bold text-[#4A553A]">Śruti</h1>
                <p class="text-sm text-stone-500 mt-1">The Gita Listening Room</p>
            </div>
            <nav id="playlist-container" class="flex-grow overflow-y-auto">
                <!-- Playlist items will be dynamically inserted here -->
            </nav>
            <div class="p-4 border-t border-stone-200">
                <button id="about-button" class="playlist-item w-full text-left p-4 hover:bg-stone-100 transition-colors">
                    <span class="font-semibold text-lg">About this Project</span>
                </button>
            </div>
        </aside>

        <!-- Right Panel: Content -->
        <main class="w-full md:w-2/3 lg:w-3/4 xl:w-4/5 h-screen overflow-y-auto bg-[#F4F1E9] flex flex-col">
            <div class="p-6 md:p-10 lg:p-12 flex-grow">
                <div class="max-w-4xl mx-auto h-full flex flex-col">
                    <div id="player-area" class="mb-8">
                        <h2 id="chapter-title" class="text-4xl font-bold text-stone-700 mb-4">Welcome</h2>
                        <audio id="audio-player" controls class="w-full rounded-lg shadow-md"></audio>
                    </div>

                    <div id="text-area" class="flex-grow bg-white/50 p-8 rounded-lg shadow-inner overflow-y-auto prose-styles">
                        <p>Please select a chapter from the playlist to begin listening.</p>
                    </div>

                     <div id="gemini-interaction" class="mt-8">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                             <h3 class="font-semibold text-lg text-stone-700 mb-3">Ask about this chapter</h3>
                             <textarea id="gemini-input" rows="2" class="w-full border-stone-300 rounded-md shadow-sm p-2 text-base focus:ring-[#4A553A] focus:border-[#4A553A]" placeholder="e.g., What is the main theme?"></textarea>
                             <button id="gemini-button" class="w-full mt-3 bg-[#4A553A] text-white font-semibold py-3 px-5 rounded-lg hover:bg-[#3b442e] transition-colors flex items-center justify-center text-md shadow-sm">
                                <span>✨ Get Insights</span>
                            </button>
                             <p id="offline-notice" class="text-center text-sm text-amber-700 mt-3 hidden">Insights are unavailable while offline.</p>
                        </div>
                        <div id="explanation-container" class="mt-6 bg-white p-8 rounded-lg shadow-md hidden">
                            <h3 class="text-2xl font-semibold text-stone-700 mb-4">AI-Powered Insight</h3>
                            <div id="explanation-content" class="prose-styles max-w-none text-stone-600 leading-relaxed"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
             const gitaAudioData = [
                {
                    chapter: 1,
                    title: "Arjuna's Dilemma",
                    audioSrc: "https://raw.githubusercontent.com/ashutoshmjain/shutri/main/audio/bg01.mp3",
                    text: `<p>Verse 1:<br>Dhṛtarāṣṭra inquired...` // Full text omitted for brevity
                },
                // ... other chapters
            ];
            
            const aboutPageContent = `
                <h3>Our Mission</h3>
                <p>Welcome to <strong>Śruti</strong>, a digital space dedicated to an immersive auditory experience of the Bhagavad Gita. The name itself, <em>Śruti</em>, refers to knowledge that is heard—a wisdom passed down through sound, resonating with us on a primal level. This project honors that tradition, presenting a poetic English rendition of the Gita designed to be listened to, reflected upon, and felt.</p>
                <p>The Bhagavad Gita is the first scribed source of <em>Karmyoga</em> and a foundational <em>Smriti</em>—a collective memory embedded within us all. It is a universal conversation between the mortal (represented by Arjuna's questions) and the divine (represented by Krishna's wisdom). This dialogue transcends religion, race, and profession; it speaks to the core of the human condition.</p>
                <p>Our goal is to offer this timeless wisdom in a clean, modern, and accessible format, free from the distractions of the modern web. This is a space for focus, learning, and introspection.</p>
                <h3>A Note from the Author</h3>
                <p>I created this rendition of the Gita out of a personal need—to understand this profound text in a way that felt authentic to me. The existing translations, while valuable, often felt dense and archaic. I wanted to hear the Gita's wisdom in a rhythm and voice that resonated with the way we communicate today. This project is the result of that journey.</p>
                <p>This web application is designed to be a "clean internet" experience. It is free of cookies, trackers, and advertisements. It is simply a quiet room for you to listen, read, and explore.</p>
                <h3>How to Use This App</h3>
                <ul class="list-disc list-inside">
                    <li><strong>Playlist Navigation:</strong> On the left (or in the slide-out menu on mobile), you will find the chapter playlist. Click on any chapter to begin the audio and display the corresponding text.</li>
                    <li><strong>Read Along:</strong> As the audio plays, you can read the full poetic transcript in the main content area.</li>
                    <li><strong>AI-Powered Insights:</strong> At the bottom of each chapter's text, you'll find an input box. If a particular concept or verse sparks your curiosity, you can ask a question. Our integrated AI will provide a detailed explanation based on the context of the chapter you are listening to.</li>
                    <li><strong>Offline Experience (PWA):</strong> This app is a Progressive Web App (PWA). After your first visit, the audio and text for all chapters will be saved to your device, allowing you to listen and read offline. You can also "Add to Home Screen" on your mobile device for an app-like experience.</li>
                </ul>
                <h3>Listen on Your Favorite Platform</h3>
                <p>You can also find this poetic rendition as a podcast on all major platforms.</p>
                <ul class="list-disc list-inside">
                    <li><a href="#" class="text-blue-600 hover:underline">Link to Spotify Podcast</a></li>
                    <li><a href="#" class="text-blue-600 hover:underline">Link to Apple Podcasts</a></li>
                    <li><a href="#" class="text-blue-600 hover:underline">Link to Google Podcasts</a></li>
                </ul>
                <h3>Support This Project</h3>
                <p>This project is a labor of love, offered for free to all who seek it. If you find value in this work, please consider supporting its continued development and hosting.</p>
                <div class="text-center p-4 mt-4 border border-dashed border-stone-400 rounded-lg">
                <p><em>
                <lightning-widget 
                     name="Thanks for supporting the publication" 
                     accent="#f9ce00" 
                     to="shutosha@primal.net" 
                     image="https://nostrcheck.me/media/5af0794606a15b5641e25aa23d04af4cb0d7d5e68b11cacb47e56a4698fca8c4/49ff6d00cb5bc819cd19f77783d4815fbd46a5b99b6fbdead1eaecfab798187b.webp" 
                     />
                <script src="https://embed.twentyuno.net/js/app.js"></script>
                </em></p>
                </div>
            `;


            const playlistContainer = document.getElementById('playlist-container');
            const audioPlayer = document.getElementById('audio-player');
            const chapterTitle = document.getElementById('chapter-title');
            const textArea = document.getElementById('text-area');
            const geminiInteraction = document.getElementById('gemini-interaction');
            const aboutButton = document.getElementById('about-button');
            const playerArea = document.getElementById('player-area');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const playlistPanel = document.getElementById('playlist-panel');
            let currentChapterData = null;

            function showAboutPage() {
                document.querySelectorAll('.playlist-item').forEach(item => item.classList.remove('active'));
                aboutButton.classList.add('active');
                
                chapterTitle.textContent = 'About This Project';
                textArea.innerHTML = `<div class="fade-in">${aboutPageContent}</div>`;
                textArea.scrollTop = 0;
                
                playerArea.classList.add('hidden');
                geminiInteraction.classList.add('hidden');

                if(window.innerWidth < 768) {
                    playlistPanel.classList.add('menu-closed');
                }
            }

            function loadChapter(chapterData, autoplay = true) {
                currentChapterData = chapterData;
                
                playerArea.classList.remove('hidden');
                geminiInteraction.classList.remove('hidden');

                chapterTitle.textContent = `Chapter ${chapterData.chapter}: ${chapterData.title}`;
                audioPlayer.src = chapterData.audioSrc;
                textArea.innerHTML = `<div class="fade-in">${chapterData.text.replace(/<p>/g, '<p class="mb-4">')}</div>`;
                textArea.scrollTop = 0;
                
                if (autoplay) {
                    audioPlayer.play().catch(e => console.log("Autoplay prevented by browser. User must interact first."));
                }

                document.querySelectorAll('.playlist-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.chapter == chapterData.chapter);
                });

                if(window.innerWidth < 768) {
                    playlistPanel.classList.add('menu-closed');
                }
            }

            gitaAudioData.forEach(chapterData => {
                const button = document.createElement('button');
                button.className = 'playlist-item w-full text-left p-4 border-b border-stone-200 hover:bg-stone-100 transition-colors';
                button.dataset.chapter = chapterData.chapter;
                button.innerHTML = `<span class="font-semibold text-lg">Chapter ${chapterData.chapter}</span><span class="block text-sm opacity-75">${chapterData.title}</span>`;
                button.addEventListener('click', () => loadChapter(chapterData));
                playlistContainer.appendChild(button);
            });

            aboutButton.addEventListener('click', showAboutPage);
            mobileMenuButton.addEventListener('click', () => {
                playlistPanel.classList.toggle('menu-closed');
            });
            
            // ... (rest of the script for Gemini, etc. remains the same)
            
            if(gitaAudioData.length > 0){
                loadChapter(gitaAudioData[0], false);
            }
        });
    </script>
</body>
</html>

